<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Download  <%= data.name %> torrent</title>
    <meta name="description" content="Download grátis via torrent do jogo <%= data.name %>, baixe na playtorrent, game para <%= data.platform %> do genero <% data.class.forEach(element => { %><%= element %>, <% }) %>" >
    <link rel="stylesheet" href="/css/styles.css">
    <link rel="stylesheet" href="/css/global.css">
    <link rel="icon" href="/favicon.ico" type="image/x-icon" />
    

</head>
<body class="bg-gray-900 text-white ">
    <%- include('./components/navbar.ejs') %>

    <main >
        <section class="p-4  md:flex items-center justify-around m-auto max-w-screen-xl mt-2">
            <a href="javascript:void(0);" onclick="history.back();">Voltar</a><br><br>
            <h1 class="md:text-5xl text-2xl text-center">Game: <%= data.name %></h1>
        </section>

        <section class="p-4  grid grid-cols-1   md:flex items-center justify-around m-auto max-w-screen-xl md:gap-0 gap-4">
            <img src="/cover/<%= data.img %>" id="imgCover" onerror="substituirImagemPadrao()" alt="" class="w-52 h-72 rounded-md object-cover md:m-0 m-auto bg-black">
            
            <iframe
                title="<%= 'Trailer video do jogo: ' + data.name %>"
                src="<%= data.video %>"
                frameborder="0"
                class="bg-gray-600 w-full md:w-auto md:h-72 object-cover aspect-video rounded-md"
                allow="autoplay; encrypted-media"
            ></iframe>
        
        </section>
    </main>

    <article>
        <section class="p-4  m-auto max-w-screen-xl">
            <p><%= data.description %></p>
        </section>

        <section class="p-4  m-auto max-w-screen-xl">
            <p><%= data.information %></p>
        </section>

        <% if (data.class && data.class.length !== 0) { %>
            <section class="p-4  m-auto max-w-screen-xl flex space-x-3">
                <% data.class.forEach(element => { %>
                    <p c><%= element %></p>
                <% }) %>
            </section>
        <% } %>
    </article>


    
    
    <section class="p-4  m-auto max-w-screen-xl">
        <!-- tipo: jogo <p><%= data.type %></p> <br> --> 
        <p>Plataforma: <%= data.platform %></p>
    </section>
    
    <% if (data.download) { %>
        <section class="p-4  m-auto max-w-screen-xl">
            <p>DOWNLOADS: <%= data.download %></p>
        </section>
    <% } %>
    
    <section class="p-4  m-auto grid grid-cols-1 md:grid-cols-2 md:max-w-[35%] gap-4  items-center space-x-4  ">

        <button onclick="download('<%= data.link %>', true)" class="m-auto max-w-72 md:m-0  px-4 py-2 bg-blue-500 hover:bg-blue-700 hover:shadow-lg duration-300 text-white text-center rounded-md w-full ">
            DOWNLOAD
        </button>
        
 
        <button onclick="copyToClipboard('<%= data.link %>', this), download('<%= data.link %>', false)" class="m-auto max-w-72  py-2 rounded-md bg-gray-500 hover:bg-gray-600 duration-300 hover:shadow-md  flex items-center justify-center space-x-2 px-8" style="margin-left: auto; margin-right: auto;" >
            <span>
                <img src="/icons/icons8-copiar-96.png" class="w-7" alt="">
            </span>
            <p >MAGNET LINK</p>
            
        </button>
   
    </section>

    <%- include('./components/keywords.ejs', {name: data.name}) %>

    <%- include('./components/footer.ejs') %>


</body>
</html>

<script>



    function copyToClipboard(text, btn) {
        const textarea = document.createElement('textarea');
        textarea.value = text;
        document.body.appendChild(textarea);
        textarea.select();
        document.execCommand('copy');
        document.body.removeChild(textarea);

        btn.style.backgroundColor = 'rgb(34 197 94 / var(--tw-bg-opacity))'
        btn.style.color = 'black'
        setTimeout(() => {
            btn.style.backgroundColor = 'rgb(107 114 128 / var(--tw-bg-opacity))'
            btn.style.color = 'white'
        }, 1000);
    }




    
    const gameId = '<%= data.id %>';
    const url = `https://www.playtorrent.com.br/viewCont/${gameId}`


    fetch(url, {
        method: 'PATCH',
        headers: {
            'Content-Type': 'application/json',
        },
    })
    .then((response) => {
        if (!response.ok) {
            throw new Error(`Erro ao contar visualização: ${response.status}`);
        }
        return response.json(); // Converte a resposta para JSON
    })
    .then((data) => {
        console.log('Visualização contada com sucesso!');
        console.log(`Visualizações: ${data.views}`);
    })
    .catch((error) => {
        console.error('Erro ao contar visualização:', error);
        // Trate o erro de acordo com suas necessidades
    });





    // const gameId = '<%= data.id %>';
    // const url = `https://www.playtorrent.com.br/viewCont/${gameId}`


    // fetch(url, {
    //     method: 'PATCH',
    //     headers: {
    //         'Content-Type': 'application/json',
    //     },
    // })
    // .then((response) => {
    //     if (!response.ok) {
    //         throw new Error(`Erro ao contar visualização: ${response.status}`);
    //     }
    //     return response.json(); // Converte a resposta para JSON
    // })
    // .then((data) => {
    //     console.log('Visualização contada com sucesso!');
    //     console.log(`Visualizações: ${data.views}`);
    // })
    // .catch((error) => {
    //     console.error('Erro ao contar visualização:', error);
    //     // Trate o erro de acordo com suas necessidades
    // });



    async function download(link, direcionar){
     
        const id = '<%= data.id %>';
        const url = `https://www.playtorrent.com.br/downloadCont/${id}`
        //const url = `http://localhost:3000/downloadCont/${id}`

        fetch(url, {
            method: 'PATCH',
            headers: {
                'Content-Type': 'application/json',
            },
        })

        .then((response) => {
            if (!response.ok) {
                throw new Error(`Erro ao contar download: ${response.status}`);
                console.log('Erro ao contar download')
            }
            return response.json(); // Converte a resposta para JSON
        })
        .then((data) => {
            console.log('Download contado com sucesso!');
            console.log(`Download: ${data.download}`);

            // Redireciona para a página desejada
            if(direcionar){
              window.open(link, '_blank');
            }    
        })
        .catch((error) => {
            console.error('Erro ao contar Download:', error);
            // Trate o erro de acordo com suas necessidades
            // Redireciona para a página desejada
            if(direcionar){
              window.open(link, '_blank');
            }    
        });
    }


    function substituirImagemPadrao() {
      // Seleciona a imagem
      var imagem = document.querySelector('#imgCover');

      // Substitui a src da imagem pela imagem padrão
      imagem.src = '/default-img-cover.webp';

      // Opcional: Pode definir um texto alternativo para a imagem padrão
      imagem.alt = 'Imagem Padrão';
    }
</script>
